<!DOCTYPE html>
<!--
    Christine Jordan & Kelcee Chorba
    Week 8 Team Project: Sorting Quiz
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Hogwarts Sorting Quiz</title>
    <link href="QuizStyle.css" rel="stylesheet" type="text/css" />
    <link href="glowButton.css" rel="stylesheet" type="text/css" />
    <!--REFERENCE: https://www.iconarchive.com/show/desktop-halloween-icons-by-aha-soft/Hat-icon.html-->
    <link href="wizardhat.ico" rel="icon" type="image/x-icon" />
</head>
<body>

    <!--
    Sample Example Output generated by loadQuestions which gets added between the content of <div id="questions"></div>:
       <div class="header">Sorting House Quiz</div>
        <div class="question">
        <div class="title"> Question #</div>
        <div class="question-text">Am I a question?</div>
        <div class="answers">
            <label class="answer-item"><input type="radio" name="Question#" value="Gryffindor">Answer A</label>
            <label class="answer-item"><input type="radio" name="Question#" value="Ravenclaw">Answer B</label>
            <label class="answer-item"><input type="radio" name="Question#" value="Hufflepuff">Answer C</label>
            <label class="answer-item"><input type="radio" name="Question#" value="Slytherin">Answer D</label>
        </div>
    </div>
    ... x 20 questions
    -->

    <form onsubmit="return calculateHouse();">
        <div id="questions"></div>
        <div style="width:100%; padding-left: 30%;padding-right: 30%;">
            <button class="glow-on-hover" type="submit">Test Results!</button>
        </div>
    </form>


    <!--https://www.w3schools.com/xml/tryit.asp?filename=try_dom_xmlhttprequest_responsexml-->
    <script type="text/javascript">
        function loadQuestions() {
            var xmlRequest = new XMLHttpRequest();
            xmlRequest.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    var xml = xmlRequest.responseXML; //xml document loaded. node tree.

                    var headerTag = xml.createElement('header');
                    var headerText = xml.createTextNode('Sorting House Quiz');

                    headerTag.appendChild(headerText); //adding a child to questions root

                    var root = xml.getElementsByTagName('questions');
                    root[0].appendChild(headerTag); //puts header inside of questions. adding node to node tree.

                    var header = xml.getElementsByTagName('header')[0]; //retrieving header from updated NODE INSERT

                    loop(xml);

                    var html = '';

                     //USE INSERTED NODE TO CREATE HEADER
                    html += '<div class="header"><span class="headertext">' + header.textContent + '</span></div>';

                    var questions = xml.getElementsByTagName('question');
                    for (var i = 0; i < questions.length; i++) {
                        html += '<div class="question">';

                        var title = questions[i].children[0].textContent;
                        html += '<div class="title">' + title + '</div>';

                        var questionText = questions[i].children[1].textContent;
                        html += '<div class="question-text">' + questionText + '</div>';

                        var answers = questions[i].children[2].children;

                        html += '<div class="answers">';

                        for (var j = 0; j < answers.length; j++) {
                            var house = answers[j].getAttribute('house');
                            var answerText = answers[j].children[0].textContent;

                            var answerId = title.replace(' ', '');
                            html += '<label class="answer-item"><input type="radio" name="' + answerId + '" value="' + house + '">' + answerText + '</label>';
                        }
                        html += '</div></div>';
                    }

                    document.getElementById('questions').innerHTML = html;
                }
            };
            xmlRequest.open('GET', 'Sorting.xml', true);
            xmlRequest.send();
        };


        loadQuestions();

        //calculating house score
        function calculateHouse() {

            var gryffindorScore = 0;
            var ravenclawScore = 0;
            var hufflepuffScore = 0;
            var slytherinScore = 0;

            //loop to get 20 question answers
            for (var i = 0; i < 20; i++) {
                var rbAnswers = document.getElementsByName('Question' + (i + 1)); //radiobutton answers

                var isAnswerSelected = false;
                for (var j = 0; j < rbAnswers.length; j++) {
                    if (rbAnswers[j].checked) {
                        switch (rbAnswers[j].value) {
                            case 'Gryffindor':
                                gryffindorScore++;
                                isAnswerSelected = true;
                                break;
                            case 'Ravenclaw':
                                ravenclawScore++;
                                isAnswerSelected = true;
                                break;
                            case 'Hufflepuff':
                                hufflepuffScore++;
                                isAnswerSelected = true;
                                break;
                            case 'Slytherin':
                                slytherinScore++;
                                isAnswerSelected = true;
                                break;
                            default:
                                alert('Undeclared House!');
                        }

                        break;
                    }
                }
                if (isAnswerSelected == false) {
                    alert('Please answer question ' + (i + 1)); //making sure answer is selected
                    return false;
                }

            }
            //creating dictionary variable
            var results = {};
            results['Gryffindor'] = gryffindorScore; //results[key]
            results['Ravenclaw'] = ravenclawScore;
            results['Hufflepuff'] = hufflepuffScore;
            results['Slytherin'] = slytherinScore;

            var selectedHouse = '';
            var highestScore = 0;
            for (var key in results) {
                var score = results[key];
                if (highestScore < score) {
                    highestScore = score;
                    selectedHouse = key;
                }
            }
            //alert(selectedHouse);
            //REFERENCE FOR IMAGES: http://getwallpapers.com/collection/slytherin-crest-wallpaper
            switch (selectedHouse) {
                case 'Gryffindor':
                    window.location.replace('gryffindor.png');
                    break;
                case 'Ravenclaw':
                    window.location.replace('ravenclaw.jpg');
                    break;
                case 'Hufflepuff':
                    window.location.replace('hufflepuff.jpg');
                    break;
                case 'Slytherin':
                    window.location.replace('slytherin.jpg');
                    break;
                default:
            }


            return false;
        }

        //FILTER BY NODE TYPE, OUTPUT TO CONSOLE
        function loop(node) {
            var nodes = node.childNodes; //will loop through children
            for (var i = 0; i < nodes.length; i++) {
                if (!nodes[i]) { //if no node here, keep looping
                    continue;
                }

                if (nodes[i].nodeType == 1) {
                    console.log('Node Name: ' + nodes[i].nodeName + ' Node Type: ' + nodes[i].nodeType + ' Node Value: ' + nodes[i].nodeValue);

                }
                
                
                if (nodes[i].childNodes.length > 0) { //if this node also has children
                    loop(nodes[i]); //recurse into function again
                }

            }
        }
    </script>
</body>
</html>